<!DOCTYPE html>
<html>

<head>
    <title>文件管理器</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="./js/index.js"></script>
    <style>
        .selectable-block {
            cursor: pointer;
            padding: 5px;
            border: 1px solid #ccc;
            margin-bottom: 5px;
        }

        .selected {
            background-color: #f5f5f5;
            border-color: #999;
        }
    </style>
    <script src="../static/js/index.js"></script>
</head>

<body>
    <h1>文件管理器</h1>
    <div id="file_list"></div>
    <script>
        // 在文档加载完成后调用 generate_list 函数
        $(document).ready(function () {
            $.getJSON(json_name, function (data) {
                generate_list(data, $('#file_list'));  // 传递要附加文件列表的父元素

            });
        });

        var socket = io.connect('http://localhost:5000');
        socket.on('message', function (msg) {
            console.log(msg);
            alert(msg);
        });
    </script>
    <hr>
    <form action="{{ url_for('upload_file', path=path) }}" method="post" enctype="multipart/form-data">
        <input type="text" name="path" id="path_value" readonly>
        <input type="file" name="file">
        <input type="submit" value="上传">
    </form>
    <form action="{{ url_for('download_file', path=path)}}" method="POST" enctype="multipart/form-data">
        <input type="text" name="path" id="download_path_value" readonly>
        <input type="hidden" name="is-dir" id="download_is_dir">
        <input type="hidden" name="id" id="download_id">
        <input type="submit" value="下载">
    </form>
    <form action="{{ url_for('new_dir', path=path) }}" method="post" enctype="multipart/form-data">
        <input type="text" name="path" id="dir_path_value" readonly>
        <input type="text" name="dir_name">
        <input type="submit" value="新建文件夹">
    </form>
    <form action="{{ url_for('delete_file', path=path) }}" method="post" enctype="multipart/form-data">
        <input type="text" name="path" id="full_path_value" readonly>
        <input type="hidden" name="is-dir" id="remove_is_dir">
        <input type="hidden" name="id" id="remove_id">
        <input type="submit" value="删除">
    </form>
</body>

</html>

<script src="/socket.io/socket.io.js"></script>
<script>
    // 在客户端建立与服务器的 Socket.IO 连接
    var socket = io.connect('http://localhost:5000');

    // 监听服务器发送的消息
    socket.on('message', function (msg) {
        // 在接收到消息时触发弹窗提示
        alert('Received message: ' + msg);
    });
</script>